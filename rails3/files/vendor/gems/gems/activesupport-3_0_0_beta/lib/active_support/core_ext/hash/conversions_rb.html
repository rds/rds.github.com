<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html lang='en'>
  <head>
    <title>File: conversions.rb [Rails Framework Documentation]</title>
    <meta content='text/html; charset=UTF-8' http-equiv='Content-Type'>
    <link href='../../../../../../../../../rdoc-style.css' media='screen' rel='stylesheet' type='text/css'>
    <script type='text/javascript'>
      //<![CDATA[
        function popupCode(url) {
          window.open(url, "Code", "resizable=yes,scrollbars=yes,toolbar=no,status=no,height=150,width=400")
        }
        
        function toggleCode(id) {
          var code = document.getElementById(id)
        
          code.style.display = code.style.display != 'block' ? 'block' : 'none'
          return true
        }
        
        // Make codeblocks hidden by default
        document.writeln('<' + 'style type="text/css">.method .source pre { display: none }<\/style>')
      //]]>
    </script>
  </head>
  <body class='page'>
    <div class='file' id='wrapper'>
      <div class='header'>
        <h1 class='name'>conversions.rb</h1>
        <div class='paths'>
          vendor/gems/gems/activesupport-3.0.0.beta/lib/active_support/core_ext/hash/conversions.rb
        </div>
        <div class='last-update'>
          Last Update:
          <span class='datetime'>2010-02-09 14:59:26 +0000</span>
        </div>
      </div>
      <div id='content'>
        <div id='text'>
          <div id='method-list'>
            <h2>Methods</h2>
            <h3>public class</h3>
            <ol>
              <li><a href="#M000003">from_xml</a></li>
            </ol>
            <h3>public instance</h3>
            <ol>
              <li><a href="#M000002">rename_key</a></li>
              <li><a href="#M000001">to_xml</a></li>
            </ol>
          </div>
          <div id='context'>
            <div id='requires'>
              <h2>Required files</h2>
              <ol>
                <li>active_support/time</li>
                <li>active_support/core_ext/array/wrap</li>
                <li>active_support/core_ext/hash/reverse_merge</li>
                <li>active_support/core_ext/object/blank</li>
                <li>active_support/core_ext/string/inflections</li>
                <li>builder</li>
              </ol>
            </div>
          </div>
          <div id='section'>
            <div id='methods'>
              <h2>Public class methods</h2>
              <div class='method public-class' id='method-M000003'>
                <a name='M000003'></a>
                <div class='synopsis'>
                  <span class='name'>from_xml</span>
                  <span class='arguments'>(xml)</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000003-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000003-source'>     <span class="ruby-comment cmt"># File vendor/gems/gems/activesupport-3.0.0.beta/lib/active_support/core_ext/hash/conversions.rb, line 183</span>&#x000A;183:     <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">from_xml</span>(<span class="ruby-identifier">xml</span>)&#x000A;184:       <span class="ruby-identifier">typecast_xml_value</span>(<span class="ruby-identifier">unrename_keys</span>(<span class="ruby-constant">ActiveSupport</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMini</span>.<span class="ruby-identifier">parse</span>(<span class="ruby-identifier">xml</span>)))&#x000A;185:     <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <h2>Public instance methods</h2>
              <div class='method public-instance' id='method-M000002'>
                <a name='M000002'></a>
                <div class='synopsis'>
                  <span class='name'>rename_key</span>
                  <span class='arguments'>(key, options = {})</span>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000002-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000002-source'>     <span class="ruby-comment cmt"># File vendor/gems/gems/activesupport-3.0.0.beta/lib/active_support/core_ext/hash/conversions.rb, line 175</span>&#x000A;175:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">rename_key</span>(<span class="ruby-identifier">key</span>, <span class="ruby-identifier">options</span> = {})&#x000A;176:     <span class="ruby-identifier">camelize</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:camelize</span>) <span class="ruby-operator">&amp;&amp;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:camelize</span>]&#x000A;177:     <span class="ruby-identifier">dasherize</span> = <span class="ruby-operator">!</span><span class="ruby-identifier">options</span>.<span class="ruby-identifier">has_key?</span>(<span class="ruby-identifier">:dasherize</span>) <span class="ruby-operator">||</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:dasherize</span>]&#x000A;178:     <span class="ruby-identifier">key</span> = <span class="ruby-identifier">key</span>.<span class="ruby-identifier">camelize</span> <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">camelize</span>&#x000A;179:     <span class="ruby-identifier">dasherize</span> <span class="ruby-value">? </span><span class="ruby-identifier">key</span>.<span class="ruby-identifier">dasherize</span> <span class="ruby-operator">:</span> <span class="ruby-identifier">key</span>&#x000A;180:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
              <div class='method public-instance' id='method-M000001'>
                <a name='M000001'></a>
                <div class='synopsis'>
                  <span class='name'>to_xml</span>
                  <span class='arguments'>(options = {}) {|options[:builder] if block_given?| ...}</span>
                </div>
                <div class='description'>
                  <p>
                  Returns a string containing an XML representation of its receiver:
                  </p>
                  <pre>{&quot;foo&quot; =&gt; 1, &quot;bar&quot; =&gt; 2}.to_xml&#x000A;# =&gt;&#x000A;# &lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#x000A;# &lt;hash&gt;&#x000A;#   &lt;foo type=&quot;integer&quot;&gt;1&lt;/foo&gt;&#x000A;#   &lt;bar type=&quot;integer&quot;&gt;2&lt;/bar&gt;&#x000A;# &lt;/hash&gt;</pre>
                  <p>
                  To do so, the method loops over the pairs and builds nodes that depend on
                  the <em>values</em>. Given a pair <tt>key</tt>, <tt>value</tt>:
                  </p>
                  <ul>
                  <li>If <tt>value</tt> is a hash there&#8217;s a recursive call with
                  <tt>key</tt> as <tt>:root</tt>.
                  
                  </li>
                  <li>If <tt>value</tt> is an array there&#8217;s a recursive call with
                  <tt>key</tt> as <tt>:root</tt>, and <tt>key</tt> singularized as
                  <tt>:children</tt>.
                  
                  </li>
                  <li>If <tt>value</tt> is a callable object it must expect one or two arguments.
                  Depending on the arity, the callable is invoked with the <tt>options</tt>
                  hash as first argument with <tt>key</tt> as <tt>:root</tt>, and
                  <tt>key</tt> singularized as second argument. Its return value becomes a
                  new node.
                  
                  </li>
                  <li>If <tt>value</tt> responds to <tt><a
                  href="conversions_rb.html#M000001">to_xml</a></tt> the method is invoked
                  with <tt>key</tt> as <tt>:root</tt>.
                  
                  </li>
                  <li>Otherwise, a node with <tt>key</tt> as tag is created with a string
                  representation of <tt>value</tt> as text node. If <tt>value</tt> is
                  <tt>nil</tt> an attribute &#8220;nil&#8221; set to &#8220;true&#8221; is
                  added. Unless the option <tt>:skip_types</tt> exists and is true, an
                  attribute &#8220;type&#8221; is added as well according to the following
                  mapping:
                  
                  <pre>XML_TYPE_NAMES = {&#x000A;  &quot;Symbol&quot;     =&gt; &quot;symbol&quot;,&#x000A;  &quot;Fixnum&quot;     =&gt; &quot;integer&quot;,&#x000A;  &quot;Bignum&quot;     =&gt; &quot;integer&quot;,&#x000A;  &quot;BigDecimal&quot; =&gt; &quot;decimal&quot;,&#x000A;  &quot;Float&quot;      =&gt; &quot;float&quot;,&#x000A;  &quot;TrueClass&quot;  =&gt; &quot;boolean&quot;,&#x000A;  &quot;FalseClass&quot; =&gt; &quot;boolean&quot;,&#x000A;  &quot;Date&quot;       =&gt; &quot;date&quot;,&#x000A;  &quot;DateTime&quot;   =&gt; &quot;datetime&quot;,&#x000A;  &quot;Time&quot;       =&gt; &quot;datetime&quot;&#x000A;}</pre>
                  </li>
                  </ul>
                  <p>
                  By default the root node is &#8220;hash&#8221;, but that&#8217;s
                  configurable via the <tt>:root</tt> option.
                  </p>
                  <p>
                  The default XML builder is a fresh instance of <tt>Builder::XmlMarkup</tt>.
                  You can configure your own builder with the <tt>:builder</tt> option. The
                  method also accepts options like <tt>:dasherize</tt> and friends, they are
                  forwarded to the builder.
                  </p>
                </div>
                <div class='source'>
                  <a class='source-toggle' href='#' onclick="toggleCode('M000001-source'); return false">
                    [show source]
                  </a>
                  <pre id='M000001-source'>     <span class="ruby-comment cmt"># File vendor/gems/gems/activesupport-3.0.0.beta/lib/active_support/core_ext/hash/conversions.rb, line 120</span>&#x000A;120:   <span class="ruby-keyword kw">def</span> <span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">options</span> = {})&#x000A;121:     <span class="ruby-identifier">require</span> <span class="ruby-value str">'builder'</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-keyword kw">defined?</span>(<span class="ruby-constant">Builder</span>)&#x000A;122: &#x000A;123:     <span class="ruby-identifier">options</span> = <span class="ruby-identifier">options</span>.<span class="ruby-identifier">dup</span>&#x000A;124:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:indent</span>] <span class="ruby-operator">||=</span> <span class="ruby-value">2</span>&#x000A;125:     <span class="ruby-identifier">options</span>.<span class="ruby-identifier">reverse_merge!</span>({ <span class="ruby-identifier">:builder</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-constant">Builder</span><span class="ruby-operator">::</span><span class="ruby-constant">XmlMarkup</span>.<span class="ruby-identifier">new</span>(<span class="ruby-identifier">:indent</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:indent</span>]),&#x000A;126:                              <span class="ruby-identifier">:root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-value str">&quot;hash&quot;</span> })&#x000A;127:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>].<span class="ruby-identifier">instruct!</span> <span class="ruby-keyword kw">unless</span> <span class="ruby-identifier">options</span>.<span class="ruby-identifier">delete</span>(<span class="ruby-identifier">:skip_instruct</span>)&#x000A;128:     <span class="ruby-identifier">root</span> = <span class="ruby-identifier">rename_key</span>(<span class="ruby-identifier">options</span>[<span class="ruby-identifier">:root</span>].<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">options</span>)&#x000A;129: &#x000A;130:     <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>].<span class="ruby-identifier">__send__</span>(<span class="ruby-identifier">:method_missing</span>, <span class="ruby-identifier">root</span>) <span class="ruby-keyword kw">do</span>&#x000A;131:       <span class="ruby-identifier">each</span> <span class="ruby-keyword kw">do</span> <span class="ruby-operator">|</span><span class="ruby-identifier">key</span>, <span class="ruby-identifier">value</span><span class="ruby-operator">|</span>&#x000A;132:         <span class="ruby-keyword kw">case</span> <span class="ruby-identifier">value</span>&#x000A;133:           <span class="ruby-keyword kw">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Hash</span>&#x000A;134:             <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:skip_instruct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }))&#x000A;135:           <span class="ruby-keyword kw">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Array</span>&#x000A;136:             <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:children</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">singularize</span>, <span class="ruby-identifier">:skip_instruct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span>}))&#x000A;137:           <span class="ruby-keyword kw">when</span> <span class="ruby-operator">::</span><span class="ruby-constant">Method</span>, <span class="ruby-operator">::</span><span class="ruby-constant">Proc</span>&#x000A;138:             <span class="ruby-comment cmt"># If the Method or Proc takes two arguments, then</span>&#x000A;139:             <span class="ruby-comment cmt"># pass the suggested child element name.  This is</span>&#x000A;140:             <span class="ruby-comment cmt"># used if the Method or Proc will be operating over</span>&#x000A;141:             <span class="ruby-comment cmt"># multiple records and needs to create an containing</span>&#x000A;142:             <span class="ruby-comment cmt"># element that will contain the objects being</span>&#x000A;143:             <span class="ruby-comment cmt"># serialized.</span>&#x000A;144:             <span class="ruby-keyword kw">if</span> <span class="ruby-value">1</span> <span class="ruby-operator">==</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">arity</span>&#x000A;145:               <span class="ruby-identifier">value</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:skip_instruct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }))&#x000A;146:             <span class="ruby-keyword kw">else</span>&#x000A;147:               <span class="ruby-identifier">value</span>.<span class="ruby-identifier">call</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:skip_instruct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }), <span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>.<span class="ruby-identifier">singularize</span>)&#x000A;148:             <span class="ruby-keyword kw">end</span>&#x000A;149:           <span class="ruby-keyword kw">else</span>&#x000A;150:             <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">respond_to?</span>(<span class="ruby-identifier">:to_xml</span>)&#x000A;151:               <span class="ruby-identifier">value</span>.<span class="ruby-identifier">to_xml</span>(<span class="ruby-identifier">options</span>.<span class="ruby-identifier">merge</span>({ <span class="ruby-identifier">:root</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">key</span>, <span class="ruby-identifier">:skip_instruct</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-keyword kw">true</span> }))&#x000A;152:             <span class="ruby-keyword kw">else</span>&#x000A;153:               <span class="ruby-identifier">type_name</span> = <span class="ruby-constant">XML_TYPE_NAMES</span>[<span class="ruby-identifier">value</span>.<span class="ruby-identifier">class</span>.<span class="ruby-identifier">name</span>]&#x000A;154: &#x000A;155:               <span class="ruby-identifier">key</span> = <span class="ruby-identifier">rename_key</span>(<span class="ruby-identifier">key</span>.<span class="ruby-identifier">to_s</span>, <span class="ruby-identifier">options</span>)&#x000A;156: &#x000A;157:               <span class="ruby-identifier">attributes</span> = <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:skip_types</span>] <span class="ruby-operator">||</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-operator">||</span> <span class="ruby-identifier">type_name</span>.<span class="ruby-identifier">nil?</span> <span class="ruby-value">? </span>{ } <span class="ruby-operator">:</span> { <span class="ruby-identifier">:type</span> =<span class="ruby-operator">&gt;</span> <span class="ruby-identifier">type_name</span> }&#x000A;158:               <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">value</span>.<span class="ruby-identifier">nil?</span>&#x000A;159:                 <span class="ruby-identifier">attributes</span>[<span class="ruby-identifier">:nil</span>] = <span class="ruby-keyword kw">true</span>&#x000A;160:               <span class="ruby-keyword kw">end</span>&#x000A;161: &#x000A;162:               <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>].<span class="ruby-identifier">tag!</span>(<span class="ruby-identifier">key</span>,&#x000A;163:                 <span class="ruby-constant">XML_FORMATTING</span>[<span class="ruby-identifier">type_name</span>] <span class="ruby-operator">?</span> <span class="ruby-constant">XML_FORMATTING</span>[<span class="ruby-identifier">type_name</span>].<span class="ruby-identifier">call</span>(<span class="ruby-identifier">value</span>) <span class="ruby-operator">:</span> <span class="ruby-identifier">value</span>,&#x000A;164:                 <span class="ruby-identifier">attributes</span>&#x000A;165:               )&#x000A;166:             <span class="ruby-keyword kw">end</span>&#x000A;167:         <span class="ruby-keyword kw">end</span>&#x000A;168:       <span class="ruby-keyword kw">end</span>&#x000A;169:       &#x000A;170:       <span class="ruby-keyword kw">yield</span> <span class="ruby-identifier">options</span>[<span class="ruby-identifier">:builder</span>] <span class="ruby-keyword kw">if</span> <span class="ruby-identifier">block_given?</span>&#x000A;171:     <span class="ruby-keyword kw">end</span>&#x000A;172: &#x000A;173:   <span class="ruby-keyword kw">end</span></pre>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id='footer-push'></div>
    </div>
    <div id='footer'>
      <a href="http://github.com/mislav/hanna/tree/master"><strong>Hanna</strong> RDoc template</a>
    </div>
  </body>
</html>
